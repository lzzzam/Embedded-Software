/**
 ******************************************************************************
 * @file    main.c
 * @author  Auto-generated by STM32CubeIDE
 * @version V1.0
 * @brief   Default main function.
 ******************************************************************************
 */
#include <stdint.h>

#if !defined(__SOFT_FP__) && defined(__ARM_FP)
#warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif

#define RCC_CR				*((uint32_t *)0x40021000UL)
#define RCC_CFGR2			*((uint32_t *)0x4002102CUL)
#define RCC_AHBENR_ADDR		*((uint32_t *)0x40021014UL)
#define ADC12EN				28

#define ADC1_CR_ADDR		*((uint32_t *)0x50000008UL)
#define ADVREGEN 			28
#define ADEN				0
#define ADSTART				2
#define ADC1_ISR_ADDR		*((uint32_t *)0x50000000UL)
#define ADRDY				0
#define EOC					2
#define ADC1_CFGR_ADDR		*((uint32_t *)0x5000000CUL)
#define CONT				13
#define ADC1_SQR1_ADDR		*((uint32_t *)0x50000030UL)
#define L3					0
#define SQ1					6
#define ADC1_2_CCR_ADDR		*((uint32_t *)0x50000308UL)
#define TSEN				23
#define ADC1_DR_ADDR		*((uint32_t *)0x50000040UL)

#define __IO	volatile
#define RCC_BASE_ADDR		0x40021000UL
#define RCC					((RCC_t *)RCC_BASE_ADDR)
struct {
	__IO uint32_t 	CR;
	__IO uint32_t	CFGR;
	__IO uint32_t	CIR;
	__IO uint32_t	APB2RSTR;
	__IO uint32_t	APB1RSTR;
	__IO uint32_t	AHBENR;
	__IO uint32_t	APB2ENR;
	__IO uint32_t	APB1ENR;
	__IO uint32_t	BDCR;
	__IO uint32_t	CSR;
	__IO uint32_t	AHBRSTR;
	__IO uint32_t	CFGR2;
	__IO uint32_t	CFGR3;
}RCC_t;

int main(void)
{
	uint32_t value = 0;

	RCC->CR = 1;

	//Enable ADC12_CLK and set Prescaler to 1
	RCC_CFGR2 |= (1 << 8);

	//PLL Enable
	RCC_CR |= (1 << 24);

	//Wait PLL clock ready Flag
	while( !(RCC_CR & (1 << 25)) );

	//Enable ADC1 clock
	RCC_AHBENR_ADDR	|= (1 << ADC12EN);

	//CLKMODE = 1 --> Clk input from AHB
	//ADC1_2_CCR_ADDR |= (1 << 16);

	//Enable ADC1 Voltage Regulator
	ADC1_CR_ADDR &= ~(1 << (ADVREGEN+1));
	ADC1_CR_ADDR |= (1 << ADVREGEN);

	//Enable ADC1
	ADC1_CR_ADDR |= (1 << ADEN);

	//Wait until ADC1 is ready for operation
	while( !(ADC1_ISR_ADDR & (1 << ADRDY)) );

	//Set Single Conversion Mode
	ADC1_CFGR_ADDR &= ~(1 << CONT);

	//Set length of group acquisition equal to 1
	ADC1_SQR1_ADDR |= (1 << L3);

	//Select Temperature Sensor as input
	ADC1_SQR1_ADDR |= (0xF << SQ1);

	//Enable Temperature Sensor
	ADC1_2_CCR_ADDR |= (1 << TSEN);

	while(1){
		//Start ADC1
		ADC1_CR_ADDR |= (1 << ADSTART);

		//Wait for End of Conversion Flag
		while( !(ADC1_ISR_ADDR & (1 << EOC)) );

		//Read Result from Data Register
		value = ADC1_DR_ADDR;
	}

	for(;;);
}
